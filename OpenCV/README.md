

# Hough Transfer
1. 영상 인식 단계
입력 영상이 얻어지면 전처리를 통하여 잡음을 제거 -> 영상 안의 물체들을 분리하는 영상 분할 수행 -> 분리된 각각의 물체들에 대한 특징 추출을 하여 여러 속성을 얻음 -> 속성을 이용하여 물체를 분류 

2. 특징 추출
: 입력 영상에는 물체를 분류하는데 필요하지 않은 많은 정보가 들어있다. 따라서 영상 인식의 첫 번째 단계는 영상에 포함된 중요한 정보만을 남기고 나머지 부분을 생략하여 영상을 단순화하는 것이다, 예를들어 자동차 타이어를 찾으려고 한다면 타이어의 원형 모양을 식별할 수 있는 특징을 사용해야한다.이렇게 중요하지 않은 정보를 버리고 에지와 같은 필수적인 정보를 추출하는 것을 특징 추출이라고한다.
- 특징 : 에지, 직선, 원, 코너, 블로브 검출, 리지 검출, Haar특징, HOG, SIFT, SURF
- 에지 : 탐지용 사각형을 수직으로 움직이면 많은 변화(but 수평은 변화X) 
- 코너 : 수직, 수평방향 어디로 움직이든 많은 변화가 있다. 즉, 코너가 제일 좋은 특징이라고 할 수 있다.
기계학습 : 입력 -> 특징 추출(인간) -> 분류(컴퓨터) -> 출력
딥러닝 : 입력 -> 특징 추출 + 분류(컴퓨터) -> 출력 
: 영상에서 직선, 원, 타원, 곡선과 같은 기하학적 요소들을 검출하는 것은 상당히 중요하다.

3. 허프(Hough) 변환

(1) 허프 변환 이론
가장 단순한 허프 변환은 직선을 검출하는 경우이다. 직선은 y = mx + b로 나타낼 수 있다.
영상에서 직선에 있을 것으로 추정되는 한 점(x0, y0)을 발견했다고 하자. 아직 한 점만 가지고는 어떤 직선인지 파악할 수 없다. 하나의 점(x0, y0)을 지나는 직선은 많다. (x0, y0)을 지나는 직선의 m, b는 다음식을 만족할 것이다. b = -x0m + y0(매개 변수 공간계), 만약 지나는 두 점(x1, x2)를 찾게 된다면 매개 변수 공간계에서는 한 점(m, b)을 지나는 서로 다른 직선일 것이다. 
-> 더 많은 점을 발견했다고 하자. 이 점을 지나는 모든 직선들을 매개변수 공간에 표시한다면 매개변수 공간에서의 교차점을 두고 서로 다른 직선이 될 것이다.
-> 어떻게 하면 교차점을 찾을 수 있을까?, 매개변수 공간의 같은 점을 지나는 직선들은 일반 좌표계에서 한 직선위의 점들이다. (일반 좌표계의 점들은 매개변수 공간에서는 직선으로 표현되기 때문) 
-> 후보점이 발견될 때마다 점을 지날 수 있는 모든 직선의 (m, b)를 매개변수 공간에서 찾아서 하나씩 증가시킨다.(누적) 만약 직선상에 후보점이 10개라면 특정한 (m, b)의 누적값이 10이 된다. 매개변수 공강네서 누적의 최대값을 찾으면 그것이 바로 후보점들로 이루어진 직선의 방정식이 된다.

(2) 극좌표계
위와 같이 y = mx + b 형태의 직선의 방정식은 결정적인 '약점'이 있다. 바로 기울기가 무한대가 될 수 있다는 점이다. 따라서 매개변수 공간을 채우려면 어마어마한 배열이 필요하다.
-> 연구자들은 다음과 같이 원점에서부터의 수직 거리와 x추고가 이루는 각도로도 직선을 나타낼 수 있다는 것을 발견했다. r = x * cos𝜽 + y * sin𝜽, r : 원점과 직선사이의 최단거리, 𝜽 : x축과 이루는 각도(0~180)
-> 후보 점 두개가 있다면 각각의 점에서 나올 수 있는 모든 직선의 r과 𝜽를 그래프로 그리면 두 그래프가 겹치는 즉, r과 𝜽가 같은 부분이 있다. 그 교점이 직선의 방정식이다.

(3) 구현
핵심적인 아이디어는 각 화소가 투표를 할 수 있게 하는 것이다. 따라서 누적기 배열(array of accumulator)가 필요하다. 직선을 검출하는 경우 누적기 배열은 단순한 2차원 배열이다. 수평축은 직선의 각도(𝜽)를 나타내며 수직축은 원점에서 직선까지의 거리(r)을 나타낸다.
-> 배열이 만들어졌으면, 에지 영상(테두리 검출?)에서 모든 에지 화소들을 반복적으로 처리한다. 만약 화소의 값이 0이라면 무시한다. 즉 에지가 아니므로 직선일 확률도 없다고 생각하는 것
-> 화소의 값이 1이라면 매개변수 공간에 사인파를 생성한다 𝜽 = -90부터 시작하여서 대응되는 r값을 계산한다. 누적기 배열에서 (𝜽, r) 셀에 투표한다. 이와 같은 동작을 𝜽 = +90까지 되풀이한다.
-> r - 𝜽공간에서 누적값이 최대가 되는 점의 r, 𝜽값을 r = xcos𝜽 + ysin𝜽에 대입하면, 직선이 얻어진다.

< OpenCV에서의 허프 변환 >
OpenCV에서는 2가지의 함수를 지원한다.

(1) HoughLines() 함수를 이용하여 표준적인 허프 변환을 수행할 수 있다. 이 함수는 (𝜽, r) 형태의 벡터로 결과를 반환하기 때문에 (𝜽, r)을 이용하여 직접 직선의 방정식으로 변환하여야한다. 
- void HoughLines(InputArray image, OutputArray lines, double rho, double theta, int threshold)
- image : 에지 검출기의 출력, grayscale 영상이어야 한다.
- lines : 검출된 직선의 매개변수를 저장하는 (𝜽, r) 형태의 벡터
- rho : 매개변수 r의 해상도를 화소로 나타낸 것이다. 여기서는 1을 사용 
- theta : 매개변수의 𝜽의 해상도를 나타낸 것이다. 여기서는 1도를 사용한다.(CV_PI/180)
- threshold : 직선을 검출하는데 필요한 교차점의 최소 개수 

(2) HoughLinesP() 함수를 이용하여 확률적인 허프 직선 변환을 수행할 수 있다. 이 함수는 (x0, y0, x1, y1) 형태의 벡터로 결과를 반환한다.
- void HoughLinesP(InputArray image, OutputArray lines, double rho, double theta, int threshold, double minLineLength=0, double maxLineGap=0)
- minLineLength : 직선의 최소 길이
- maxLineGap : 하나의 직선으로 간주되는 점들 사이의 최대 거리 
